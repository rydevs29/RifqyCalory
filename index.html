<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>RifqyCalory</title>
  <link rel="manifest" href="data:application/manifest+json,{\"name\":\"RifqyCalory\",\"short_name\":\"Calory\",\"start_url\":\"index.html\",\"display\":\"standalone\",\"background_color\":\"#0f0c29\",\"theme_color\":\"#6c5ce7\"}">
  <meta name="theme-color" content="#6c5ce7">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #6c5ce7; --yellow: #ffd43b; --danger: #ff6b6b;
      --bg: #0f0c29; --glass: rgba(255,255,255,0.09); --text: #fff;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: var(--text);
      min-height: 100dvh;
      padding: 20px 16px 100px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    .container {
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
    }

    /* HEADER */
    .header {
      text-align: center;
      margin-bottom: 24px;
    }
    h1 {
      font-size: 2.8rem;
      font-weight: 700;
      background: linear-gradient(to right, #6c5ce7, #8f94fb);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .subtitle {
      font-size: 1rem;
      opacity: 0.9;
      margin-top: 8px;
    }

    /* TABS */
    .tab-nav {
      display: flex;
      gap: 12px;
      margin: 24px 0 20px;
    }
    .tab-btn {
      flex: 1;
      padding: 16px;
      border-radius: 50px;
      background: var(--glass);
      color: var(--text);
      border: none;
      font-weight: 600;
      font-size: 1.05rem;
      transition: 0.3s;
    }
    .tab-btn.active {
      background: var(--primary);
      color: white;
    }

    /* SEARCH */
    .search-box {
      width: 100%;
      padding: 18px 20px;
      font-size: 1.1rem;
      border: none;
      border-radius: 50px;
      background: rgba(255,255,255,0.12);
      color: white;
      backdrop-filter: blur(12px);
      text-align: center;
    }
    .search-box::placeholder {
      color: rgba(255,255,255,0.6);
    }
    .search-results {
      margin-top: 16px;
      max-height: 340px;
      overflow-y: auto;
      background: var(--glass);
      border-radius: 24px;
      padding: 12px;
    }
    .search-item {
      padding: 18px;
      background: rgba(255,255,255,0.08);
      border-radius: 20px;
      margin: 10px 0;
      cursor: pointer;
      transition: 0.2s;
    }
    .search-item:hover {
      background: rgba(255,255,255,0.18);
    }
    .search-item .name {
      font-weight: 600;
      font-size: 1.15rem;
    }
    .search-item .cal {
      color: var(--yellow);
      margin-top: 6px;
      font-size: 0.95rem;
    }

    /* RESULT CARD */
    .result-card {
      background: var(--glass);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 32px;
      padding: 28px;
      margin-top: 24px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    }
    .result-card h3 {
      font-size: 1.9rem;
      margin-bottom: 16px;
      font-weight: 700;
    }
    .gizi {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 12px;
      margin: 20px 0;
      font-size: 1rem;
      font-weight: 500;
    }
    .gizi > div {
      flex: 1;
      min-width: 100px;
    }
    .chart-container {
      height: 220px;
      margin: 24px 0;
    }
    .btn-save {
      width: 100%;
      padding: 18px;
      background: var(--yellow);
      color: #222;
      border: none;
      border-radius: 50px;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
    }

    /* HISTORY */
    .daily-total {
      background: rgba(255,212,59,0.2);
      color: var(--yellow);
      padding: 20px;
      border-radius: 28px;
      text-align: center;
      font-size: 1.3rem;
      font-weight: 700;
      margin: 20px 0;
    }
    .history-item {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 24px;
      margin-bottom: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .history-item .info .time {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-bottom: 6px;
    }
    .history-item .info .name {
      font-weight: 600;
      font-size: 1.2rem;
    }
    .history-item .info .cal {
      color: var(--yellow);
      font-weight: 700;
      margin-top: 4px;
    }
    .btn-delete {
      background: var(--danger);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 50px;
      font-size: 0.9rem;
      cursor: pointer;
    }
    .clear-all {
      width: 100%;
      padding: 18px;
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 50px;
      font-weight: 600;
      margin-top: 20px;
      font-size: 1.05rem;
    }

    /* BOTTOM NAV */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--glass);
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255,255,255,0.1);
      display: flex;
      padding: 16px;
      z-index: 1000;
    }
    .nav-item {
      flex: 1;
      text-align: center;
      padding: 16px;
      border-radius: 50px;
      font-weight: 600;
      font-size: 0.95rem;
      transition: 0.3s;
    }
    .nav-item.active {
      background: var(--primary);
      color: white;
    }

    .lang-toggle {
      position: fixed;
      top: 16px;
      right: 16px;
      background: var(--glass);
      padding: 8px 16px;
      border-radius: 50px;
      font-size: 0.9rem;
      z-index: 9999;
      backdrop-filter: blur(10px);
    }

    .hidden { display: none !important; }
    .page { display: none; }
    .page.active { display: block; }
  </style>
</head>
<body>

  <div class="lang-toggle" onclick="toggleLang()">ID | EN</div>

  <div class="container">

    <!-- CARI -->
    <div id="search-page" class="page active">
      <div class="header">
        <h1>RifqyCalory</h1>
        <p class="subtitle">Cari makanan & minuman</p>
      </div>

      <div class="tab-nav">
        <button class="tab-btn active" onclick="switchTab('makanan')">Makanan</button>
        <button class="tab-btn" onclick="switchTab('minuman')">Minuman</button>
      </div>

      <input type="text" id="searchInput" class="search-box" placeholder="Ketik nama makanan/minuman..." autofocus onkeyup="searchFood()">

      <div id="searchResults" class="search-results"></div>

      <div id="result" class="result-card hidden">
        <h3 id="food-name">-</h3>
        <div class="gizi">
          <div><strong id="calories">0</strong> kcal</div>
          <div>Karbo: <strong id="carb">0g</strong></div>
          <div>Prot: <strong id="protein">0g</strong></div>
          <div>Lemak: <strong id="fat">0g</strong></div>
        </div>
        <div class="chart-container"><canvas id="giziChart"></canvas></div>
        <button class="btn-save" onclick="saveHistory()">Simpan ke Riwayat</button>
      </div>
    </div>

    <!-- RIWAYAT -->
    <div id="history-page" class="page">
      <div class="header">
        <h1>Riwayat</h1>
        <p class="subtitle">Semua yang kamu cari</p>
      </div>

      <div id="daily-total" class="daily-total hidden">
        Total Hari Ini: <span id="today-cal">0</span> kcal
      </div>

      <div id="history-list"></div>

      <button class="clear-all" onclick="clearAllHistory()">Hapus Semua Riwayat</button>
    </div>

    <!-- TENTANG -->
    <div id="about-page" class="page">
      <div class="header">
        <h1>Tentang</h1>
        <p class="subtitle">RifqyCalory v10 • 280+ item makanan & minuman Indonesia</p>
        <p style="text-align:center; margin-top:40px; opacity:0.7; font-size:0.9rem;">
          © 2025 RifqyLCC • All rights reserved
        </p>
      </div>
    </div>
  </div>

  <div class="bottom-nav">
    <div class="nav-item active" onclick="showPage('search')">Cari</div>
    <div class="nav-item" onclick="showPage('history')">Riwayat</div>
    <div class="nav-item" onclick="showPage('about')">Tentang</div>
  </div>

  <script>
    let lang = (navigator.language || navigator.userLanguage).startsWith('id') ? 'id' : 'en';
    let currentTab = 'makanan';
    let db = {}, chart;

    async function loadData() {
      try {
        const [mkn, mnm] = await Promise.all([
          fetch('makanan.js').then(r => r.text()),
          fetch('minuman.js').then(r => r.text())
        ]);
        eval(mkn); eval(mnm);
        db.makanan = window.makananDB;
        db.minuman = window.minumanDB;
      } catch(e) {
        alert('Gagal memuat database');
      }
    }

    function switchTab(t) {
      currentTab = t;
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelector(`.tab-btn[onclick="switchTab('${t}')"]`).classList.add('active');
      document.getElementById('result').classList.add('hidden');
      document.getElementById('searchInput').value = '';
      document.getElementById('searchResults').innerHTML = '';
    }

    function showPage(p) {
      document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
      document.getElementById(p + '-page').classList.add('active');
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.querySelector(`.nav-item[onclick="showPage('${p}')"]`).classList.add('active');
      if (p === 'history') loadHistory();
    }

    function toggleLang() {
      lang = lang === 'id' ? 'en' : 'id';
      document.querySelectorAll('[data-id],[data-en]').forEach(el => {
        el.textContent = el.dataset[lang] || el.dataset.en;
      });
      loadHistory();
    }

    function searchFood() {
      const q = document.getElementById('searchInput').value.toLowerCase().trim();
      const res = document.getElementById('searchResults');
      res.innerHTML = '';
      if (q.length < 2) return;

      const items = Object.values(db[currentTab]).filter(i => i.name.toLowerCase().includes(q));
      if (items.length === 0) {
        res.innerHTML = '<div style="padding:20px;text-align:center;opacity:0.7">Tidak ditemukan</div>';
        return;
      }

      items.slice(0,15).forEach(item => {
        const div = document.createElement('div');
        div.className = 'search-item';
        div.innerHTML = `<div class="name">${item.name}</div>
                         <div class="cal">\( {item.cal} kcal • Karbo \){item.carb}g • Prot \( {item.prot}g • Lemak \){item.fat}g</div>`;
        div.onclick = () => {
          displayResult(item);
          res.innerHTML = '';
          document.getElementById('searchInput').value = item.name;
        };
        res.appendChild(div);
      });
    }

    function displayResult(item) {
      document.getElementById('food-name').textContent = item.name;
      document.getElementById('calories').textContent = item.cal;
      document.getElementById('carb').textContent = item.carb + 'g';
      document.getElementById('protein').textContent = item.prot + 'g';
      document.getElementById('fat').textContent = item.fat + 'g';
      document.getElementById('result').classList.remove('hidden');

      if (chart) chart.destroy();
      chart = new Chart(document.getElementById('giziChart'), {
        type: 'doughnut',
        data: {
          labels: ['Karbo', 'Protein', 'Lemak'],
          datasets: [{ data: [item.carb, item.prot, item.fat], backgroundColor: ['#51cf66','#ffd43b','#ff6b6b'], borderWidth: 0 }]
        },
        options: { responsive: true, plugins: { legend: { position: 'bottom' }}, cutout: '70%' }
      });
    }

    function saveHistory() {
      const name = document.getElementById('food-name').textContent;
      const cal = parseInt(document.getElementById('calories').textContent);
      const h = JSON.parse(localStorage.getItem('rifqyHistory') || '[]');
      const now = new Date();
      const date = now.toLocaleDateString('id-ID', { day:'numeric', month:'short', year:'numeric' });
      const time = now.toLocaleTimeString('id-ID', { hour:'2-digit', minute:'2-digit' });

      h.push({ name, cal, date, time });
      localStorage.setItem('rifqyHistory', JSON.stringify(h));
      alert(`${name} disimpan!`);
    }

    function loadHistory() {
      const h = JSON.parse(localStorage.getItem('rifqyHistory') || '[]');
      const list = document.getElementById('history-list');
      const today = new Date().toLocaleDateString('id-ID', { day:'numeric', month:'short', year:'numeric' });
      let todayCal = 0;

      list.innerHTML = h.length === 0 ? '<p style="text-align:center;opacity:0.7;padding:40px">Belum ada riwayat</p>' : '';

      h.forEach(item => { if (item.date === today) todayCal += item.cal; });

      document.getElementById('today-cal').textContent = todayCal;
      document.getElementById('daily-total').classList.toggle('hidden', todayCal === 0);

      h.slice().reverse().forEach((item, i) => {
        const revI = h.length - 1 - i;
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `
          <div class="info">
            <div class="time">\( {item.date} • \){item.time}</div>
            <div class="name">${item.name}</div>
            <div class="cal">${item.cal} kcal</div>
          </div>
          <button class="btn-delete" onclick="deleteHistory(${revI})">Hapus</button>
        `;
        list.appendChild(div);
      });
    }

    function deleteHistory(i) {
      if (!confirm('Hapus item ini?')) return;
      const h = JSON.parse(localStorage.getItem('rifqyHistory') || '[]');
      h.splice(i, 1);
      localStorage.setItem('rifqyHistory', JSON.stringify(h));
      loadHistory();
    }

    function clearAllHistory() {
      if (!confirm('Hapus SEMUA riwayat?')) return;
      localStorage.removeItem('rifqyHistory');
      loadHistory();
    }

    loadData().then(() => {
      document.getElementById('searchInput').focus();
    });
  </script>
</body>
</html>
