<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RifqyKalori</title>
  <link rel="manifest" href="data:application/manifest+json,{
    \"name\": \"RifqyKalori\",
    \"short_name\": \"Kalori\",
    \"start_url\": \".\",
    \"display\": \"standalone\",
    \"background_color\": \"#0f0c29\",
    \"theme_color\": \"#6c5ce7\",
    \"icons\": [{ \"src\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==\", \"sizes\": \"192x192\", \"type\": \"image/png\" }]
  }">
  <meta name="theme-color" content="#6c5ce7">
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #6c5ce7; --secondary: #8f94fb; --bg: #0f0c29; --glass: rgba(255,255,255,0.1);
      --text: #ffffff; --radius: 28px; --shadow: 0 20px 40px rgba(0,0,0,0.3); --gap: 16px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); color: var(--text); min-height: 100vh; padding-bottom: 90px; }
    .container { max-width: 900px; margin: 0 auto; padding: var(--gap); }
    .header { text-align: center; margin-bottom: 16px; }
    h1 { font-size: clamp(28px, 5vw, 38px); background: linear-gradient(to right, #6c5ce7, #8f94fb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .subtitle { font-size: clamp(14px, 3.5vw, 17px); opacity: 0.9; }
    .card { backdrop-filter: blur(16px); background: var(--glass); border: 1px solid rgba(255,255,255,0.2); border-radius: var(--radius); padding: 20px; box-shadow: var(--shadow); margin-bottom: var(--gap); }
    .camera-container { position: relative; height: 300px; border-radius: 20px; overflow: hidden; margin-bottom: 16px; background: #000; }
    #video { width: 100%; height: 100%; object-fit: cover; } #canvas { display: none; }
    .btn { width: 100%; padding: 14px; font-size: 15px; font-weight: 600; border: none; border-radius: 18px; cursor: pointer; margin: 8px 0; }
    .btn-camera { background: #51cf66; color: white; } .btn-scan { background: var(--secondary); color: white; } .btn-save { background: #ffd43b; color: #333; }
    .result { margin-top: 16px; padding: 16px; background: rgba(255,255,255,0.1); border-radius: 16px; text-align: center; }
    .result h3 { margin-bottom: 8px; font-size: 18px; } .gizi { display: flex; justify-content: space-around; margin: 12px 0; font-size: 14px; }
    .chart-container { height: 180px; margin: 16px 0; }
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--glass); backdrop-filter: blur(16px); border-top: 1px solid rgba(255,255,255,0.2); display: flex; padding: 10px 12px; z-index: 1000; }
    .nav-item { flex: 1; text-align: center; padding: 10px 6px; font-size: 13px; font-weight: 600; border-radius: 18px; margin: 0 6px; transition: all 0.3s; cursor: pointer; }
    .nav-item.active { background: var(--secondary); color: white; } .hidden { display: none; }
    .history-list { display: grid; gap: 12px; } .history-item { background: rgba(255,255,255,0.1); padding: 14px; border-radius: 16px; font-size: 14px; } .history-item small { opacity: 0.7; }
  </style>
</head>
<body>

  <div class="container">
    <div class="header">
      <h1>RifqyKalori</h1>
      <p class="subtitle">Foto makanan → Kalori + Gizi otomatis!</p>
    </div>

    <!-- HOME -->
    <div id="tab-home" class="tab-content">
      <div class="card">
        <div class="camera-container">
          <video id="video" autoplay playsinline></video>
          <canvas id="canvas"></canvas>
        </div>
        <button class="btn btn-camera" onclick="startCamera()">Buka Kamera</button>
        <button class="btn btn-scan" onclick="captureAndScan()">Scan Makanan</button>

        <div id="result" class="result hidden">
          <h3 id="food-name">Nasi Goreng</h3>
          <div class="gizi">
            <div><strong id="calories">450</strong> kcal</div>
            <div>Karbo: <strong id="carb">65g</strong></div>
            <div>Prot: <strong id="protein">12g</strong></div>
            <div>Lemak: <strong id="fat">18g</strong></div>
          </div>
          <div class="chart-container"><canvas id="giziChart"></canvas></div>
          <button class="btn btn-save" onclick="saveFood()">Simpan ke Riwayat</button>
        </div>
      </div>
    </div>

    <!-- RIWAYAT -->
    <div id="tab-riwayat" class="tab-content hidden">
      <div class="card">
        <h3>Riwayat Makan</h3>
        <div id="history-list" class="history-list"></div>
      </div>
    </div>
  </div>

  <!-- BOTTOM NAV -->
  <div class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('home')">Home</div>
    <div class="nav-item" onclick="switchTab('riwayat')">Riwayat</div>
    <div class="nav-item" onclick="alert('RifqyKalori v1.0\n120+ Makanan Indonesia\nDibuat oleh Rifqy © 2025')">About</div>
  </div>

  <script>
    let video, canvas, ctx, stream, chart;
    const foodDB = {
      "nasi goreng": { name: "Nasi Goreng", cal: 450, carb: 65, prot: 12, fat: 18 },
      "mie goreng": { name: "Mie Goreng", cal: 520, carb: 70, prot: 15, fat: 22 },
      "ayam bakar": { name: "Ayam Bakar", cal: 380, carb: 10, prot: 35, fat: 25 },
      "sate ayam": { name: "Sate Ayam", cal: 320, carb: 8, prot: 28, fat: 20 },
      "rendang": { name: "Rendang", cal: 600, carb: 15, prot: 40, fat: 45 },
      "soto ayam": { name: "Soto Ayam", cal: 250, carb: 20, prot: 15, fat: 10 },
      "gado gado": { name: "Gado-Gado", cal: 320, carb: 30, prot: 10, fat: 15 },
      "tempe goreng": { name: "Tempe Goreng", cal: 164, carb: 10, prot: 10, fat: 11 },
      "tahu goreng": { name: "Tahu Goreng", cal: 144, carb: 5, prot: 8, fat: 10 },
      "kacang goreng": { name: "Kacang Goreng", cal: 580, carb: 20, prot: 20, fat: 50 },
      "pisang goreng": { name: "Pisang Goreng", cal: 300, carb: 45, prot: 3, fat: 12 },
      "roti bakar": { name: "Roti Bakar", cal: 200, carb: 30, prot: 5, fat: 8 },
      "nasi uduk": { name: "Nasi Uduk", cal: 400, carb: 60, prot: 8, fat: 12 },
      "nasi liwet": { name: "Nasi Liwet", cal: 350, carb: 55, prot: 7, fat: 10 },
      "nasi tim": { name: "Nasi Tim", cal: 250, carb: 40, prot: 6, fat: 8 },
      "bubur ayam": { name: "Bubur Ayam", cal: 280, carb: 50, prot: 12, fat: 5 },
      "bubur kacang hijau": { name: "Bubur Kacang Hijau", cal: 200, carb: 35, prot: 8, fat: 3 },
      "sayur lodeh": { name: "Sayur Lodeh", cal: 150, carb: 20, prot: 5, fat: 6 },
      "urap": { name: "Urap", cal: 120, carb: 15, prot: 4, fat: 5 },
      "karedok": { name: "Karedok", cal: 180, carb: 25, prot: 6, fat: 7 },
      "pecel": { name: "Pecel", cal: 250, carb: 30, prot: 8, fat: 12 },
      "asinan": { name: "Asinan", cal: 80, carb: 15, prot: 2, fat: 1 },
      "kari ayam": { name: "Kari Ayam", cal: 350, carb: 20, prot: 25, fat: 20 },
      "gulai ikan": { name: "Gulai Ikan", cal: 280, carb: 10, prot: 22, fat: 18 },
      "opor ayam": { name: "Opor Ayam", cal: 320, carb: 12, prot: 28, fat: 18 },
      "balado telur": { name: "Balado Telur", cal: 220, carb: 8, prot: 14, fat: 16 },
      "perkedel": { name: "Perkedel", cal: 180, carb: 15, prot: 6, fat: 10 },
      "bakwan": { name: "Bakwan", cal: 200, carb: 25, prot: 5, fat: 10 },
      "cireng": { name: "Cireng", cal: 250, carb: 40, prot: 4, fat: 8 },
      "batagor": { name: "Batagor", cal: 380, carb: 35, prot: 12, fat: 20 },
      "siomay": { name: "Siomay", cal: 300, carb: 30, prot: 15, fat: 12 },
      "pempek": { name: "Pempek", cal: 280, carb: 35, prot: 10, fat: 12 },
      "kerupuk": { name: "Kerupuk Udang", cal: 350, carb: 70, prot: 5, fat: 5 },
      "emping": { name: "Emping Melinjo", cal: 500, carb: 40, prot: 15, fat: 30 },
      "rempeyek": { name: "Rempeyek", cal: 500, carb: 50, prot: 10, fat: 30 },
      "opor tahu": { name: "Opor Tahu", cal: 180, carb: 15, prot: 10, fat: 10 },
      "sayur bayam": { name: "Sayur Bayam", cal: 80, carb: 10, prot: 4, fat: 3 },
      "sayur kolplay": { name: "Sayur Kolplay", cal: 100, carb: 15, prot: 5, fat: 4 },
      "capcay": { name: "Capcay", cal: 150, carb: 20, prot: 8, fat: 6 },
      "cah kangkung": { name: "Cah Kangkung", cal: 120, carb: 12, prot: 6, fat: 7 },
      "tahu isi": { name: "Tahu Isi", cal: 200, carb: 25, prot: 6, fat: 10 },
      "tempe mendoan": { name: "Tempe Mendoan", cal: 220, carb: 20, prot: 8, fat: 14 },
      "lumpia": { name: "Lumpia", cal: 180, carb: 22, prot: 5, fat: 8 },
      "martabak manis": { name: "Martabak Manis", cal: 450, carb: 55, prot: 8, fat: 22 },
      "martabak telur": { name: "Martabak Telur", cal: 380, carb: 30, prot: 15, fat: 20 },
      "roti cane": { name: "Roti Cane", cal: 300, carb: 40, prot: 6, fat: 12 },
      "nasi kebuli": { name: "Nasi Kebuli", cal: 500, carb: 65, prot: 20, fat: 22 },
      "nasi mandi": { name: "Nasi Mandi", cal: 480, carb: 60, prot: 18, fat: 20 },
      "nasi krawu": { name: "Nasi Krawu", cal: 420, carb: 55, prot: 15, fat: 18 },
      "nasi jagung": { name: "Nasi Jagung", cal: 350, carb: 70, prot: 8, fat: 5 },
      "nasi kuning": { name: "Nasi Kuning", cal: 400, carb: 60, prot: 8, fat: 12 },
      "nasi putih": { name: "Nasi Putih", cal: 200, carb: 45, prot: 4, fat: 0 },
      "nasi merah": { name: "Nasi Merah", cal: 180, carb: 40, prot: 5, fat: 1 },
      "nasi bakar": { name: "Nasi Bakar", cal: 450, carb: 60, prot: 12, fat: 18 },
      "nasi campur": { name: "Nasi Campur", cal: 550, carb: 70, prot: 20, fat: 25 },
      "nasi rames": { name: "Nasi Rames", cal: 520, carb: 65, prot: 18, fat: 22 },
      "nasi padang": { name: "Nasi Padang", cal: 700, carb: 80, prot: 30, fat: 35 },
      "nasi gudeg": { name: "Nasi Gudeg", cal: 480, carb: 70, prot: 10, fat: 18 },
      "nasi pecel": { name: "Nasi Pecel", cal: 380, carb: 55, prot: 12, fat: 15 },
      "nasi kucing": { name: "Nasi Kucing", cal: 250, carb: 40, prot: 6, fat: 8 },
      "nasi tempong": { name: "Nasi Tempong", cal: 450, carb: 60, prot: 15, fat: 20 },
      "nasi lengko": { name: "Nasi Lengko", cal: 350, carb: 55, prot: 10, fat: 12 },
      "nasi tutug oncom": { name: "Nasi Tutug Oncom", cal: 400, carb: 60, prot: 12, fat: 15 },
      "nasi jamblang": { name: "Nasi Jamblang", cal: 420, carb: 65, prot: 14, fat: 16 },
      "nasi liwet solo": { name: "Nasi Liwet Solo", cal: 450, carb: 65, prot: 10, fat: 18 },
      "nasi bogana": { name: "Nasi Bogana", cal: 480, carb: 70, prot: 12, fat: 20 },
      "nasi empal": { name: "Nasi Empal", cal: 520, carb: 60, prot: 25, fat: 25 },
      "nasi rawon": { name: "Nasi Rawon", cal: 500, carb: 55, prot: 30, fat: 22 },
      "nasi brongkos": { name: "Nasi Brongkos", cal: 450, carb: 50, prot: 20, fat: 20 },
      "nasi kuning manado": { name: "Nasi Kuning Manado", cal: 480, carb: 65, prot: 15, fat: 20 },
      "nasi ayam kedewatan": { name: "Nasi Ayam Kedewatan", cal: 550, carb: 70, prot: 25, fat: 25 },
      "nasi bebek madura": { name: "Nasi Bebek Madura", cal: 600, carb: 65, prot: 35, fat: 30 },
      "nasi soto": { name: "Nasi Soto", cal: 350, carb: 50, prot: 15, fat: 12 },
      "nasi kari": { name: "Nasi Kari", cal: 450, carb: 55, prot: 20, fat: 20 },
      "nasi uduk betawi": { name: "Nasi Uduk Betawi", cal: 420, carb: 60, prot: 10, fat: 15 },
      "nasi ulam": { name: "Nasi Ulam", cal: 380, carb: 55, prot: 8, fat: 14 },
      "nasi timbel": { name: "Nasi Timbel", cal: 400, carb: 60, prot: 8, fat: 12 },
      "nasi oncom": { name: "Nasi Oncom", cal: 350, carb: 55, prot: 10, fat: 10 },
      "nasi tutug": { name: "Nasi Tutug", cal: 380, carb: 58, prot: 9, fat: 12 },
      "nasi empal gentong": { name: "Nasi Empal Gentong", cal: 520, carb: 60, prot: 28, fat: 25 },
      "nasi kuning banjar": { name: "Nasi Kuning Banjar", cal: 450, carb: 65, prot: 12, fat: 18 },
      "nasi kapau": { name: "Nasi Kapau", cal: 650, carb: 75, prot: 28, fat: 32 },
      "nasi lalapan": { name: "Nasi Lalapan", cal: 450, carb: 60, prot: 20, fat: 20 },
      "nasi pecel madiun": { name: "Nasi Pecel Madiun", cal: 400, carb: 55, prot: 15, fat: 16 },
      "nasi kucing angkringan": { name: "Nasi Kucing Angkringan", cal: 220, carb: 35, prot: 5, fat: 7 },
      "nasi goreng kambing": { name: "Nasi Goreng Kambing", cal: 550, carb: 65, prot: 25, fat: 25 },
      "nasi goreng jawa": { name: "Nasi Goreng Jawa", cal: 480, carb: 60, prot: 15, fat: 20 },
      "nasi goreng pattaya": { name: "Nasi Goreng Pattaya", cal: 520, carb: 65, prot: 18, fat: 22 },
      "nasi goreng mawut": { name: "Nasi Goreng Mawut", cal: 500, carb: 62, prot: 16, fat: 20 },
      "nasi goreng seafood": { name: "Nasi Goreng Seafood", cal: 550, carb: 65, prot: 22, fat: 25 },
      "nasi goreng babat": { name: "Nasi Goreng Babat", cal: 520, carb: 60, prot: 20, fat: 22 },
      "nasi goreng pete": { name: "Nasi Goreng Pete", cal: 480, carb: 60, prot: 14, fat: 20 },
      "nasi goreng magelangan": { name: "Nasi Goreng Magelangan", cal: 500, carb: 65, prot: 15, fat: 20 },
      "nasi goreng gila": { name: "Nasi Goreng Gila", cal: 580, carb: 70, prot: 20, fat: 28 },
      "nasi goreng kampung": { name: "Nasi Goreng Kampung", cal: 450, carb: 60, prot: 12, fat: 18 },
      "nasi goreng spesial": { name: "Nasi Goreng Spesial", cal: 550, carb: 65, prot: 22, fat: 25 },
      "nasi goreng merah": { name: "Nasi Goreng Merah", cal: 480, carb: 62, prot: 15, fat: 20 },
      "nasi goreng hijau": { name: "Nasi Goreng Hijau", cal: 460, carb: 60, prot: 14, fat: 19 },
      "nasi goreng hitam": { name: "Nasi Goreng Hitam", cal: 500, carb: 65, prot: 16, fat: 22 },
      "nasi goreng kencur": { name: "Nasi Goreng Kencur", cal: 470, carb: 62, prot: 14, fat: 20 },
      "nasi goreng kunyit": { name: "Nasi Goreng Kunyit", cal: 480, carb: 63, prot: 15, fat: 20 },
      "nasi goreng rempah": { name: "Nasi Goreng Rempah", cal: 500, carb: 65, prot: 16, fat: 22 },
      "nasi goreng sunda": { name: "Nasi Goreng Sunda", cal: 460, carb: 60, prot: 14, fat: 19 },
      "nasi goreng aceh": { name: "Nasi Goreng Aceh", cal: 550, carb: 70, prot: 20, fat: 25 },
      "nasi goreng padang": { name: "Nasi Goreng Padang", cal: 520, carb: 65, prot: 18, fat: 22 },
      "nasi goreng betawi": { name: "Nasi Goreng Betawi", cal: 500, carb: 62, prot: 16, fat: 20 },
      "nasi goreng bali": { name: "Nasi Goreng Bali", cal: 480, carb: 60, prot: 15, fat: 20 },
      "nasi goreng manado": { name: "Nasi Goreng Manado", cal: 520, carb: 65, prot: 18, fat: 22 },
      "nasi goreng makassar": { name: "Nasi Goreng Makassar", cal: 500, carb: 63, prot: 16, fat: 20 },
      "nasi goreng palembang": { name: "Nasi Goreng Palembang", cal: 480, carb: 60, prot: 15, fat: 19 },
      "nasi goreng cirebon": { name: "Nasi Goreng Cirebon", cal: 460, carb: 58, prot: 14, fat: 18 },
      "nasi goreng semarang": { name: "Nasi Goreng Semarang", cal: 500, carb: 62, prot: 16, fat: 20 },
      "nasi goreng surabaya": { name: "Nasi Goreng Surabaya", cal: 520, carb: 65, prot: 18, fat: 22 },
      "nasi goreng malang": { name: "Nasi Goreng Malang", cal: 480, carb: 60, prot: 15, fat: 20 },
      "nasi goreng solo": { name: "Nasi Goreng Solo", cal: 460, carb: 58, prot: 14, fat: 18 },
      "nasi goreng yogyakarta": { name: "Nasi Goreng Yogyakarta", cal: 500, carb: 62, prot: 16, fat: 20 },
      "nasi goreng bandung": { name: "Nasi Goreng Bandung", cal: 480, carb: 60, prot: 15, fat: 19 },
      "nasi goreng jakarta": { name: "Nasi Goreng Jakarta", cal: 520, carb: 65, prot: 18, fat: 22 },
      "nasi goreng medan": { name: "Nasi Goreng Medan", cal: 550, carb: 70, prot: 20, fat: 25 },
      "nasi goreng pontianak": { name: "Nasi Goreng Pontianak", cal: 500, carb: 63, prot: 16, fat: 20 },
      "nasi goreng banjarmasin": { name: "Nasi Goreng Banjarmasin", cal: 480, carb: 60, prot: 15, fat: 19 },
      "nasi goreng palu": { name: "Nasi Goreng Palu", cal: 460, carb: 58, prot: 14, fat: 18 },
      "nasi goreng ambon": { name: "Nasi Goreng Ambon", cal: 500, carb: 62, prot: 16, fat: 20 },
      "nasi goreng papua": { name: "Nasi Goreng Papua", cal: 520, carb: 65, prot: 18, fat: 22 }
    };

    function startCamera() {
      video = document.getElementById('video'); canvas = document.getElementById('canvas'); ctx = canvas.getContext('2d');
      navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
        .then(s => { stream = s; video.srcObject = stream; video.play(); });
    }

    function captureAndScan() {
      canvas.width = video.videoWidth; canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);
      const image = canvas.toDataURL('image/jpeg');
      Tesseract.recognize(image, 'eng+ind', { logger: m => console.log(m) })
        .then(({ data: { text } }) => {
          const name = findFood(text.toLowerCase());
          if (name) displayResult(foodDB[name]);
          else alert('Makanan tidak dikenali. Coba foto lebih jelas!');
        });
    }

    function findFood(text) {
      for (let key in foodDB) {
        if (text.includes(key)) return key;
      }
      return null;
    }

    function displayResult(food) {
      document.getElementById('food-name').textContent = food.name;
      document.getElementById('calories').textContent = food.cal;
      document.getElementById('carb').textContent = food.carb + 'g';
      document.getElementById('protein').textContent = food.prot + 'g';
      document.getElementById('fat').textContent = food.fat + 'g';
      document.getElementById('result').classList.remove('hidden');
      const ctxChart = document.getElementById('giziChart').getContext('2d');
      if (chart) chart.destroy();
      chart = new Chart(ctxChart, {
        type: 'doughnut',
        data: { labels: ['Karbo', 'Protein', 'Lemak'], datasets: [{ data: [food.carb, food.prot, food.fat], backgroundColor: ['#51cf66', '#ffd43b', '#ff6b6b'] }] },
        options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
      });
    }

    function saveFood() {
      const name = document.getElementById('food-name').textContent;
      const cal = document.getElementById('calories').textContent;
      const history = JSON.parse(localStorage.getItem('rifqyKaloriHistory') || '[]');
      history.push({ name, cal, time: new Date().toLocaleString('id-ID') });
      localStorage.setItem('rifqyKaloriHistory', JSON.stringify(history));
      alert(`${name} disimpan!`);
      updateHistory();
    }

    function updateHistory() {
      const list = document.getElementById('history-list');
      const history = JSON.parse(localStorage.getItem('rifqyKaloriHistory') || '[]');
      list.innerHTML = '';
      history.slice(-10).reverse().forEach(h => {
        const div = document.createElement('div'); div.className = 'history-item';
        div.innerHTML = `<strong>${h.name}</strong> – ${h.cal} kcal<br><small>${h.time}</small>`;
        list.appendChild(div);
      });
    }

    function switchTab(tab) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
      document.getElementById(`tab-${tab}`).classList.remove('hidden');
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.querySelectorAll('.nav-item')[tab === 'home' ? 0 : 1].classList.add('active');
      if (tab === 'riwayat') updateHistory();
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('data:text/javascript,self.addEventListener("install",e=>self.skipWaiting());self.addEventListener("fetch",e=>e.respondWith(fetch(e.request)));');
    }
  </script>
</body>
</html>
