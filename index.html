<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>RifqyCalory</title>
  <link rel="manifest" href="data:application/manifest+json,{\"name\":\"RifqyCalory\",\"short_name\":\"Calory\",\"start_url\":\"index.html\",\"display\":\"standalone\",\"background_color\":\"#0f0c29\",\"theme_color\":\"#6c5ce7\"}">
  <meta name="theme-color" content="#6c5ce7">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #6c5ce7; --yellow: #ffd43b; --danger: #ff6b6b;
      --bg: #0f0c29; --glass: rgba(255,255,255,0.09); --text: #fff;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: var(--text);
      min-height: 100dvh;
      padding: 20px 16px 100px;
      display: flex;
      justify-content: center;
    }
    .container { width: 100%; max-width: 500px; margin: 0 auto; }

    .header { text-align: center; margin-bottom: 24px; }
    h1 {
      font-size: 2.8rem; font-weight: 800;
      background: linear-gradient(to right, #6c5ce7, #8f94fb);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .subtitle { font-size: 1rem; opacity: 0.9; margin-top: 8px; font-weight: 600; }

    .tab-nav { display: flex; gap: 12px; margin: 24px 0 20px; }
    .tab-btn {
      flex: 1; padding: 16px; border-radius: 50px; background: var(--glass);
      color: var(--text); border: none; font-weight: 700; font-size: 1.05rem;
    }
    .tab-btn.active { background: var(--primary); color: white; }

    .search-box {
      width: 100%; padding: 18px 20px; font-size: 1.1rem; border: none;
      border-radius: 50px; background: rgba(255,255,255,0.12); color: white;
      backdrop-filter: blur(12px); text-align: center; font-weight: 600;
    }
    .search-box::placeholder { color: rgba(255,255,255,0.6); }

    .search-results {
      margin-top: 16px; max-height: 340px; overflow-y: auto;
      background: var(--glass); border-radius: 24px; padding: 12px;
    }
    .search-item {
      padding: 18px; background: rgba(255,255,255,0.08); border-radius: 20px;
      margin: 10px 0; cursor: pointer; text-align: center;
    }
    .search-item .name { font-weight: 700; font-size: 1.15rem; }
    .search-item .cal { color: var(--yellow); margin-top: 6px; font-weight: 600; }

    .result-card {
      background: var(--glass); backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.15); border-radius: 32px;
      padding: 32px 24px; margin-top: 24px; text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    }
    .result-card h3 { font-size: 2rem; margin-bottom: 20px; font-weight: 800; }

    .gizi {
      display: grid; grid-template-columns: 1fr 1fr; gap: 18px;
      margin: 24px 0; font-size: 1.1rem; font-weight: 800;
    }

    .chart-wrapper {
      display: flex; flex-direction: column; align-items: center;
      margin: 32px 0;
    }
    .chart-container {
      height: 240px; width: 240px; margin: 0 auto;
    }
    .legend {
      display: flex; justify-content: center; gap: 20px; margin-top: 16px;
      font-weight: 700; font-size: 0.95rem;
    }
    .legend-item { display: flex; align-items: center; gap: 8px; }
    .legend-color {
      width: 16px; height: 16px; border-radius: 4px;
    }

    .btn-save {
      width: 100%; padding: 18px; background: var(--yellow); color: #222;
      border: none; border-radius: 50px; font-weight: 800; font-size: 1.1rem; cursor: pointer;
    }

    /* RIWAYAT */
    .total-all {
      background: rgba(108,92,231,0.25); color: #8f94fb; padding: 18px;
      border-radius: 28px; text-align: center; font-size: 1.2rem; font-weight: 800;
      margin: 20px 0 12px;
    }
    .daily-total {
      background: rgba(255,212,59,0.25); color: var(--yellow); padding: 18px;
      border-radius: 28px; text-align: center; font-size: 1.35rem; font-weight: 800;
      margin-bottom: 20px;
    }
    .history-item {
      background: rgba(255,255,255,0.1); padding: 20px; border-radius: 24px;
      margin-bottom: 14px; display: flex; justify-content: space-between; align-items: center;
    }
    .history-item .info .time { font-size: 0.92rem; opacity: 0.8; margin-bottom: 6px; font-weight: 600; }
    .history-item .info .name { font-weight: 800; font-size: 1.25rem; }
    .history-item .info .cal { color: var(--yellow); font-weight: 800; margin-top: 4px; }
    .btn-delete { background: var(--danger); color: white; border: none;
      padding: 10px 20px; border-radius: 50px; font-size: 0.9rem; font-weight: 700; cursor: pointer; }
    .clear-all {
      width: 100%; padding: 18px; background: var(--danger); color: white;
      border: none; border-radius: 50px; font-weight: 800; margin-top: 20px; font-size: 1.05rem;
    }

    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: var(--glass); backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255,255,255,0.1);
      display: flex; padding: 16px; z-index: 1000;
    }
    .nav-item {
      flex: 1; text-align: center; padding: 16px; border-radius: 50px;
      font-weight: 700; font-size: 0.95rem;
    }
    .nav-item.active { background: var(--primary); color: white; }

    .hidden { display: none !important; }
    .page { display: none; }
    .page.active { display: block; }
  </style>
</head>
<body>

  <div class="container">

    <!-- CARI -->
    <div id="search-page" class="page active">
      <div class="header">
        <h1>RifqyCalory</h1>
        <p class="subtitle">Mencari Makanan & Minuman dari Indonesia</p>
      </div>

      <div class="tab-nav">
        <button class="tab-btn active" onclick="switchTab('makanan')">Makanan</button>
        <button class="tab-btn" onclick="switchTab('minuman')">Minuman</button>
      </div>

      <input type="text" id="searchInput" class="search-box" placeholder="Ketik nama makanan/minuman..." autofocus onkeyup="searchFood()">

      <div id="searchResults" class="search-results"></div>

      <div id="result" class="result-card hidden">
        <h3 id="food-name">-</h3>
        <div class="gizi">
          <div><strong id="calories">0</strong> kcal</div>
          <div>Karbo: <strong id="carb">0g</strong></div>
          <div>Prot: <strong id="protein">0g</strong></div>
          <div>Lemak: <strong id="fat">0g</strong></div>
        </div>

        <div class="chart-wrapper">
          <div class="chart-container"><canvas id="giziChart"></canvas></div>
          <div class="legend">
            <div class="legend-item"><div class="legend-color" style="background:#51cf66"></div> Karbo</div>
            <div class="legend-item"><div class="legend-color" style="background:#ffd43b"></div> Protein</div>
            <div class="legend-item"><div class="legend-color" style="background:#ff6b6b"></div> Lemak</div>
          </div>
        </div>

        <button class="btn-save" onclick="saveHistory()">Simpan ke Riwayat</button>
      </div>
    </div>

    <!-- RIWAYAT -->
    <div id="history-page" class="page">
      <div class="header">
        <h1>Riwayat</h1>
        <p class="subtitle">Semua yang kamu cari</p>
      </div>

      <div id="daily-total" class="daily-total hidden">
        Total Hari Ini: <span id="today-cal">0</span> kcal
      </div>

      <div id="history-list"></div>

      <button class="clear-all" onclick="clearAllHistory()">Hapus Semua Riwayat</button>
    </div>

    <!-- TENTANG -->
    <div id="about-page" class="page">
      <div class="header">
        <h1>Tentang</h1>
        <p class="subtitle">RifqyCalory v10 • 280+ item</p>
        <p style="text-align:center; margin-top:50px; opacity:0.7; font-weight:600;">
          © 2025 RifqyLCC •
        </p>
      </div>
    </div>
  </div>

  <div class="bottom-nav">
    <div class="nav-item active" onclick="showPage('search')">Cari</div>
    <div class="nav-item" onclick="showPage('history')">Riwayat</div>
    <div class="nav-item" onclick="showPage('about')">Tentang</div>
  </div>

  <script>
    let currentTab = 'makanan';
    let db = {}, chart;

    function formatDateTime(d) {
      return d.toLocaleDateString('id-ID', { day:'numeric', month:'short', year:'numeric' }) + 
             ' • ' + 
             d.toLocaleTimeString('id-ID', { hour:'2-digit', minute:'2-digit' });
    }

    async function loadData() {
      try {
        const [mkn, mnm] = await Promise.all([
          fetch('makanan.js').then(r => r.text()),
          fetch('minuman.js').then(r => r.text())
        ]);
        eval(mkn); eval(mnm);
        db.makanan = window.makananDB;
        db.minuman = window.minumanDB;
      } catch(e) { alert('Database gagal dimuat'); }
    }

    function switchTab(t) {
      currentTab = t;
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelector(`.tab-btn[onclick="switchTab('${t}')"]`).classList.add('active');
      document.getElementById('result').classList.add('hidden');
      document.getElementById('searchInput').value = '';
      document.getElementById('searchResults').innerHTML = '';
    }

    function showPage(p) {
      document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
      document.getElementById(p + '-page').classList.add('active');
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.querySelector(`.nav-item[onclick="showPage('${p}')"]`).classList.add('active');
      if (p === 'history') loadHistory();
    }

    function searchFood() {
      const q = document.getElementById('searchInput').value.toLowerCase().trim();
      const res = document.getElementById('searchResults');
      res.innerHTML = '';
      if (q.length < 2) return;

      const items = Object.values(db[currentTab]).filter(i => i.name.toLowerCase().includes(q));
      if (!items.length) {
        res.innerHTML = '<div style="padding:20px;text-align:center;opacity:0.7">Tidak ditemukan</div>';
        return;
      }

      items.slice(0,15).forEach(item => {
        const div = document.createElement('div');
        div.className = 'search-item';
        div.innerHTML = `<div class="name">${item.name}</div>
                         <div class="cal">\( {item.cal} kcal • Karbo \){item.carb}g • Prot \( {item.prot}g • Lemak \){item.fat}g</div>`;
        div.onclick = () => { displayResult(item); res.innerHTML=''; document.getElementById('searchInput').value = item.name; };
        res.appendChild(div);
      });
    }

    function displayResult(item) {
      document.getElementById('food-name').textContent = item.name;
      document.getElementById('calories').textContent = item.cal;
      document.getElementById('carb').textContent = item.carb + 'g';
      document.getElementById('protein').textContent = item.prot + 'g';
      document.getElementById('fat').textContent = item.fat + 'g';
      document.getElementById('result').classList.remove('hidden');

      if (chart) chart.destroy();
      chart = new Chart(document.getElementById('giziChart'), {
        type: 'doughnut',
        data: {
          datasets: [{ data: [item.carb, item.prot, item.fat], backgroundColor: ['#51cf66','#ffd43b','#ff6b6b'], borderWidth: 0 }]
        },
        options: { responsive: true, maintainAspectRatio: false, cutout: '68%', plugins: { legend: { display: false } } }
      });
    }

    function saveHistory() {
      const name = document.getElementById('food-name').textContent;
      const cal = parseInt(document.getElementById('calories').textContent);
      const h = JSON.parse(localStorage.getItem('rifqyHistory') || '[]');
      h.push({ name, cal, datetime: formatDateTime(new Date()) });
      localStorage.setItem('rifqyHistory', JSON.stringify(h));
      alert('Disimpan!');
    }

    function loadHistory() {
      const h = JSON.parse(localStorage.getItem('rifqyHistory') || '[]');
      const list = document.getElementById('history-list');
      const today = new Date().toLocaleDateString('id-ID', { day:'numeric', month:'short', year:'numeric' });

      let todayCal = 0, allCal = 0;
      h.forEach(item => {
        allCal += item.cal;
        if (item.datetime.includes(today)) todayCal += item.cal;
      });

      document.getElementById('all-cal').textContent = allCal;
      document.getElementById('total-all').classList.toggle('hidden', allCal === 0);

      document.getElementById('today-cal').textContent = todayCal;
      document.getElementById('daily-total').classList.toggle('hidden', todayCal === 0);

      list.innerHTML = h.length === 0 ? '<p style="text-align:center;opacity:0.7;padding:50px;font-weight:600">Belum ada riwayat</p>' : '';

      h.slice().reverse().forEach((item, i) => {
        const revI = h.length - 1 - i;
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `
          <div class="info">
            <div class="time">${item.datetime}</div>
            <div class="name">${item.name}</div>
            <div class="cal">${item.cal} kcal</div>
          </div>
          <button class="btn-delete" onclick="deleteHistory(${revI})">Hapus</button>
        `;
        list.appendChild(div);
      });
    }

    function deleteHistory(i) {
      if (!confirm('Hapus item ini?')) return;
      const h = JSON.parse(localStorage.getItem('rifqyHistory') || '[]');
      h.splice(i, 1);
      localStorage.setItem('rifqyHistory', JSON.stringify(h));
      loadHistory();
    }

    function clearAllHistory() {
      if (!confirm('Hapus SEMUA riwayat?')) return;
      localStorage.removeItem('rifqyHistory');
      loadHistory();
    }

    loadData().then(() => document.getElementById('searchInput').focus());
  </script>
</body>
</html>
