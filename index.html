<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RifqyCalory</title>
  <link rel="manifest" href="data:application/manifest+json,{\"name\":\"RifqyCalory\",\"short_name\":\"Calory\",\"start_url\":\"index.html\",\"display\":\"standalone\",\"background_color\":\"#0f0c29\",\"theme_color\":\"#6c5ce7\",\"icons\":[{\"src\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==\",\"sizes\":\"192x192\"}]}">
  <meta name="theme-color" content="#6c5ce7">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #6c5ce7; --secondary: #8f94fb; --yellow: #ffd43b; --danger: #ff6b6b;
      --bg: #0f0c29; --glass: rgba(255,255,255,0.08); --text: #fff; --radius: 28px;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: var(--text);
      min-height: 100vh;
      padding: 20px 16px 100px;
    }
    .container { max-width: 560px; margin: 0 auto; }

    /* HEADER */
    .header { text-align: center; margin-bottom: 24px; }
    h1 {
      font-size: 2.8rem; font-weight: 700;
      background: linear-gradient(to right, #6c5ce7, #8f94fb);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .subtitle { font-size: 1rem; opacity: 0.9; margin-top: 8px; }

    /* TABS */
    .tab-nav {
      display: flex; gap: 12px; margin: 20px 0;
    }
    .tab-btn {
      flex: 1; padding: 14px; border-radius: 50px;
      background: var(--glass); color: var(--text);
      border: none; font-weight: 600; cursor: pointer;
      transition: all 0.3s;
    }
    .tab-btn.active { background: var(--primary); color: white; }

    /* SEARCH */
    .search-box {
      width: 100%; padding: 18px 20px; font-size: 1.1rem;
      border: none; border-radius: 50px; background: rgba(255,255,255,0.12);
      color: white; backdrop-filter: blur(12px);
    }
    .search-box::placeholder { color: rgba(255,255,255,0.6); }
    .search-results {
      margin-top: 12px; max-height: 360px; overflow-y: auto;
      background: var(--glass); border-radius: 20px; padding: 8px;
    }
    .search-item {
      padding: 16px; background: rgba(255,255,255,0.08);
      border-radius: 18px; margin: 8px 0; cursor: pointer;
      transition: 0.2s;
    }
    .search-item:hover { background: rgba(255,255,255,0.2); }
    .search-item .name { font-weight: 600; font-size: 1.1rem; }
    .search-item .cal { color: var(--yellow); margin-top: 4px; font-size: 0.95rem; }

    /* RESULT CARD */
    .result-card {
      background: var(--glass); backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: var(--radius); padding: 28px; margin-top: 20px;
      text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }
    .result-card h3 { font-size: 1.9rem; margin-bottom: 16px; font-weight: 700; }
    .gizi { display: flex; justify-content: space-around; margin: 20px 0; font-size: 1rem; font-weight: 500; }
    .chart-container { height: 220px; margin: 24px 0; }
    .btn-save {
      width: 100%; padding: 16px; background: var(--yellow); color: #222;
      border: none; border-radius: 50px; font-weight: 700; font-size: 1.1rem;
      cursor: pointer; margin-top: 8px;
    }

    /* HISTORY */
    .daily-total {
      background: rgba(255,212,59,0.18); color: var(--yellow);
      padding: 18px; border-radius: 24px; text-align: center;
      font-size: 1.3rem; font-weight: 700; margin-bottom: 20px;
    }
    .history-item {
      background: rgba(255,255,255,0.1); padding: 18px;
      border-radius: 20px; margin-bottom: 12px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .history-item .info .time { font-size: 0.9rem; opacity: 0.8; }
    .history-item .info .name { font-weight: 600; font-size: 1.15rem; margin: 4px 0; }
    .history-item .info .cal { color: var(--yellow); font-weight: 700; }
    .btn-delete { background: var(--danger); color: white; border: none;
      padding: 10px 18px; border-radius: 50px; font-size: 0.9rem; cursor: pointer; }

    .clear-all {
      width: 100%; padding: 16px; background: var(--danger); color: white;
      border: none; border-radius: 50px; font-weight: 600; margin-top: 20px;
    }

    /* BOTTOM NAV */
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: var(--glass); backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255,255,255,0.1);
      display: flex; padding: 12px; z-index: 1000;
    }
    .nav-item {
      flex: 1; text-align: center; padding: 14px;
      border-radius: 50px; font-weight: 600; transition: 0.3s;
    }
    .nav-item.active { background: var(--primary); color: white; }

    /* LANGUAGE TOGGLE */
    .lang-toggle {
      position: fixed; top: 20px; right: 20px; z-index: 10000;
      background: var(--glass); padding: 8px 16px; border-radius: 50px;
      font-size: 0.9rem; backdrop-filter: blur(10px);
    }

    .hidden { display: none !important; }
    .page { display: none; }
    .page.active { display: block; }

    @media (min-width: 768px) {
      body { padding: 30px 20px 120px; }
      .container { max-width: 480px; }
      h1 { font-size: 3.2rem; }
    }
  </style>
</head>
<body>

  <!-- LANGUAGE TOGGLE -->
  <div class="lang-toggle" onclick="toggleLang()">ID | EN</div>

  <div class="container">

    <!-- SEARCH PAGE -->
    <div id="search-page" class="page active">
      <div class="header">
        <h1>RifqyCalory</h1>
        <p class="subtitle" data-id="Cari makanan & minuman" data-en="Search food & drinks"></p>
      </div>

      <div class="tab-nav">
        <button class="tab-btn active" onclick="switchTab('makanan')" data-id="Makanan" data-en="Food">Food</button>
        <button class="tab-btn" onclick="switchTab('minuman')" data-id="Minuman" data-en="Drinks">Drinks</button>
      </div>

      <input type="text" id="searchInput" class="search-box" autofocus
             data-id-placeholder="Ketik nama makanan/minuman..." data-en-placeholder="Type food or drink name..."
             placeholder="Type food or drink name..." onkeyup="searchFood()">

      <div id="searchResults" class="search-results"></div>

      <div id="result" class="result-card hidden">
        <h3 id="food-name">Nasi Goreng</h3>
        <div class="gizi">
          <div><strong id="calories">450</strong> <span data-id="kcal" data-en="kcal">kcal</span></div>
          <div data-id="Karbo:" data-en="Carbs:">Carbs:</div> <strong id="carb">65g</strong>
          <div data-id="Prot:" data-en="Protein:">Protein:</div> <strong id="protein">12g</strong>
          <div data-id="Lemak:" data-en="Fat:">Fat:</div> <strong id="fat">18g</strong>
        </div>
        <div class="chart-container"><canvas id="giziChart"></canvas></div>
        <button class="btn-save" onclick="saveHistory()" data-id="Simpan ke Riwayat" data-en="Save to History">Save to History</button>
      </div>
    </div>

    <!-- HISTORY PAGE -->
    <div id="history-page" class="page">
      <div class="header">
        <h1 data-id="Riwayat" data-en="History">History</h1>
        <p class="subtitle" data-id="Semua yang kamu cari" data-en="All items you've searched"></p>
      </div>
      <div id="daily-total" class="daily-total hidden">
        <span data-id="Total Hari Ini:" data-en="Today's Total:">Today's Total:</span> <span id="today-cal">0</span> kcal
      </div>
      <div id="history-list"></div>
      <button class="clear-all" onclick="clearAllHistory()" data-id="Hapus Semua Riwayat" data-en="Clear All History">Clear All History</button>
    </div>

    <!-- ABOUT PAGE -->
    <div id="about-page" class="page">
      <div class="header">
        <h1 data-id="Tentang" data-en="About">About</h1>
        <p class="subtitle">RifqyCalory v10 • 280+ items</p>
        <p style="text-align:center; margin-top:30px; opacity:0.8;">
          Copyright © 2025 RifqyLCC. All rights reserved.
        </p>
      </div>
    </div>
  </div>

  <!-- BOTTOM NAV -->
  <div class="bottom-nav">
    <div class="nav-item active" onclick="showPage('search')" data-id="Cari" data-en="Search">Search</div>
    <div class="nav-item" onclick="showPage('history')" data-id="Riwayat" data-en="History">History</div>
    <div class="nav-item" onclick="showPage('about')" data-id="Tentang" data-en="About">About</div>
  </div>

  <script>
    let lang = (navigator.language || navigator.userLanguage).startsWith('id') ? 'id' : 'en';
    let currentTab = 'makanan';
    let db = {}, chart;

    // === BAHASA ===
    function applyLang() {
      document.querySelectorAll('[data-id],[data-en]').forEach(el => {
        el.textContent = el.dataset[lang] || el.dataset.en;
        if (el.placeholder !== undefined) {
          el.placeholder = lang === 'id' ? el.dataset.idPlaceholder : el.dataset.enPlaceholder;
        }
      });
      document.documentElement.lang = lang === 'id' ? 'id' : 'en';
    }
    function toggleLang() {
      lang = lang === 'id' ? 'en' : 'id';
      applyLang();
      loadHistory(); // refresh tanggal
    }

    // === LOAD DATA ===
    async function loadData() {
      try {
        const [mkn, mnm] = await Promise.all([
          fetch('makanan.js').then(r => r.text()),
          fetch('minuman.js').then(r => r.text())
        ]);
        eval(mkn); eval(mnm);
        db.makanan = window.makananDB;
        db.minuman = window.minumanDB;
      } catch(e) { alert('Database gagal dimuat'); }
    }

    // === TAB & PAGE ===
    function switchTab(t) {
      currentTab = t;
      document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
      document.querySelector(`.tab-btn[onclick="switchTab('${t}')"]`).classList.add('active');
      document.getElementById('result').classList.add('hidden');
      document.getElementById('searchInput').value = '';
      document.getElementById('searchResults').innerHTML = '';
    }
    function showPage(p) {
      document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));
      document.getElementById(p + '-page').classList.add('active');
      document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
      document.querySelector(`.nav-item[onclick="showPage('${p}')"]`).classList.add('active');
      if (p==='history') loadHistory();
    }

    // === SEARCH ===
    function searchFood() {
      const q = document.getElementById('searchInput').value.toLowerCase().trim();
      const res = document.getElementById('searchResults');
      res.innerHTML = '';
      if (q.length < 2) return;

      const items = Object.values(db[currentTab]).filter(i =>
        i.name.toLowerCase().includes(q)
      );

      if (items.length === 0) {
        res.innerHTML = `<div style="padding:20px;text-align:center;opacity:0.7">${lang==='id'?'Tidak ditemukan':'No results'}</div>`;
        return;
      }

      items.slice(0,15).forEach(item => {
        const div = document.createElement('div');
        div.className = 'search-item';
        div.innerHTML = `<div class="name">${item.name}</div>
                         <div class="cal">\( {item.cal} kcal • \){lang==='id'?'Karbo':'Carbs'} \( {item.carb}g • \){lang==='id'?'Prot':'Protein'} \( {item.prot}g • \){lang==='id'?'Lemak':'Fat'} ${item.fat}g</div>`;
        div.onclick = () => { displayResult(item); res.innerHTML=''; document.getElementById('searchInput').value = item.name; };
        res.appendChild(div);
      });
    }

    function displayResult(item) {
      document.getElementById('food-name').textContent = item.name;
      document.getElementById('calories').textContent = item.cal;
      document.getElementById('carb').textContent = item.carb + 'g';
      document.getElementById('protein').textContent = item.prot + 'g';
      document.getElementById('fat').textContent = item.fat + 'g';
      document.getElementById('result').classList.remove('hidden');

      if (chart) chart.destroy();
      chart = new Chart(document.getElementById('giziChart'), {
        type: 'doughnut',
        data: { labels: [lang==='id'?'Karbo':'Carbs', lang==='id'?'Protein':'Protein', lang==='id'?'Lemak':'Fat'],
                datasets: [{ data: [item.carb, item.prot, item.fat],
                             backgroundColor: ['#51cf66','#ffd43b','#ff6b6b'], borderWidth:0 }] },
        options: { responsive:true, plugins:{legend:{position:'bottom'}}, cutout:'68%' }
      });
    }

    // === HISTORY ===
    function saveHistory() {
      const name = document.getElementById('food-name').textContent;
      const cal = parseInt(document.getElementById('calories').textContent);
      const h = JSON.parse(localStorage.getItem('rifqyHistory')||'[]');
      const now = new Date();
      h.push({
        name, cal,
        date: now.toLocaleDateString(lang==='id'?'id-ID':'en-GB'),
        time: now.toLocaleTimeString(lang==='id'?'id-ID':'en-US',{hour:'2-digit',minute:'2-digit'})
      });
      localStorage.setItem('rifqyHistory', JSON.stringify(h));
      alert(lang==='id'?`\( {name} disimpan!`:` \){name} saved!`);
    }

    function loadHistory() {
      const h = JSON.parse(localStorage.getItem('rifqyHistory')||'[]');
      const list = document.getElementById('history-list');
      const today = new Date().toLocaleDateString(lang==='id'?'id-ID':'en-GB');
      let todayCal = 0;

      list.innerHTML = h.length===0 ? `<p style="text-align:center;opacity:0.7;padding:30px;">${lang==='id'?'Belum ada riwayat':'No history yet'}</p>` : '';

      h.forEach(item => { if (item.date===today) todayCal += item.cal; });

      document.getElementById('today-cal').textContent = todayCal;
      document.getElementById('daily-total').classList.toggle('hidden', todayCal===0);

      h.slice().reverse().forEach((item, i) => {
        const revI = h.length-1-i;
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `
          <div class="info">
            <div class="time">\( {item.date} • \){item.time}</div>
            <div class="name">${item.name}</div>
            <div class="cal">${item.cal} kcal</div>
          </div>
          <button class="btn-delete" onclick="deleteHistory(\( {revI})"> \){lang==='id'?'Hapus':'Delete'}</button>
        `;
        list.appendChild(div);
      });
    }

    function deleteHistory(i) {
      if (!confirm(lang==='id'?'Hapus item ini?':'Delete this item?')) return;
      const h = JSON.parse(localStorage.getItem('rifqyHistory')||'[]');
      h.splice(i,1);
      localStorage.setItem('rifqyHistory', JSON.stringify(h));
      loadHistory();
    }
    function clearAllHistory() {
      if (!confirm(lang==='id'?'Hapus SEMUA riwayat?':'Clear ALL history?')) return;
      localStorage.removeItem('rifqyHistory');
      loadHistory();
    }

    // INIT
    loadData().then(() => {
      applyLang();
      document.getElementById('searchInput').focus();
    });
  </script>
</body>
</html>
