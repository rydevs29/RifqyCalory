<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>RifqyCalory</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--p:#6c5ce7;--y:#ffd43b;--r:#ff6b6b;--bg:#0f0c29;--g:rgba(255,255,255,0.09)}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);color:#fff;min-height:100dvh;padding:20px 16px 100px;display:flex;justify-content:center}
    .c{width:100%;max-width:500px;margin:0 auto}
    h1{font-size:2.8rem;font-weight:800;background:linear-gradient(to right,#6c5ce7,#8f94fb);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-align:center}
    .s{font-weight:600;opacity:0.9;text-align:center;margin-top:8px}
    .tab{display:flex;gap:12px;margin:24px 0 20px}
    .tb{flex:1;padding:16px;border-radius:50px;background:var(--g);color:#fff;border:none;font-weight:700}
    .tb.active{background:var(--p);color:#fff}
    .in{width:100%;padding:18px 20px;font-size:1.1rem;border:none;border-radius:50px;background:rgba(255,255,255,0.12);color:#fff;text-align:center;font-weight:600;backdrop-filter:blur(12px)}
    .res{margin-top:16px;max-height:340px;overflow-y:auto;background:var(--g);border-radius:24px;padding:12px}
    .ri{padding:18px;background:rgba(255,255,255,0.08);border-radius:20px;margin:10px 0;text-align:center;cursor:pointer}
    .ri .n{font-weight:800;font-size:1.15rem}
    .ri .c{color:var(--y);margin-top:6px;font-weight:600}

    .card{background:var(--g);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.15);border-radius:32px;padding:32px 24px;margin-top:24px;text-align:center;box-shadow:0 20px 40px rgba(0,0,0,0.4)}
    .card h3{font-size:2rem;margin-bottom:20px;font-weight:800}
    .gizi{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin:24px 0;font-size:1.1rem;font-weight:800}
    .chart-wrap{display:flex;flex-direction:column;align-items:center;margin:32px 0}
    .chart{height:240px;width:240px}
    .leg{display:flex;justify-content:center;gap:20px;margin-top:16px;font-weight:700}
    .leg div{display:flex;align-items:center;gap:8px}
    .leg span{width:16px;height:16px;border-radius:4px;display:inline-block}
    .btn{width:100%;padding:18px;background:var(--y);color:#222;border:none;border-radius:50px;font-weight:800;font-size:1.1rem;cursor:pointer}

    .daily-total{background:rgba(255,212,59,0.25);color:var(--y);padding:20px;border-radius:28px;text-align:center;font-size:1.4rem;font-weight:800;margin:20px 0}
    .hi{background:rgba(255,255,255,0.1);padding:20px;border-radius:24px;margin-bottom:14px;display:flex;justify-content:space-between;align-items:center}
    .hi .t{font-size:0.92rem;opacity:0.8;margin-bottom:6px;font-weight:600}
    .hin{font-weight:800;font-size:1.25rem}
    .hic{color:var(--y);font-weight:800;margin-top:4px}
    .del{background:var(--r);color:#fff;border:none;padding:10px 20px;border-radius:50px;font-weight:700}
    .clear{background:var(--r);color:#fff;width:100%;padding:18px;border:none;border-radius:50px;font-weight:800;margin-top:20px}

    .nav{position:fixed;bottom:0;left:0;right:0;background:var(--g);backdrop-filter:blur(20px);border-top:1px solid rgba(255,255,255,0.1);display:flex;padding:16px;z-index:1000}
    .ni{flex:1;text-align:center;padding:16px;border-radius:50px;font-weight:700}
    .ni.active{background:var(--p);color:#fff}

    .hidden{display:none !important}
    .page{display:none}.page.active{display:block}
  </style>
</head>
<body>

<div class="c">

  <!-- CARI -->
  <div id="search-page" class="page active">
    <h1>RifqyCalory</h1>
    <p class="s">Mencari Makanan & Minuman dari Indonesia</p>
    <div class="tab">
      <button class="tb active" onclick="switchTab('makanan')">Makanan</button>
      <button class="tb" onclick="switchTab('minuman')">Minuman</button>
    </div>
    <input type="text" id="i" class="in" placeholder="Ketik nama makanan/minuman..." autofocus onkeyup="searchFood()">
    <div id="res" class="res"></div>

    <div id="card" class="card hidden">
      <h3 id="name">-</h3>
      <div class="gizi">
        <div><strong id="kcal">0</strong> kcal</div>
        <div>Karbo: <strong id="k">0g</strong></div>
        <div>Prot: <strong id="p">0g</strong></div>
        <div>Lemak: <strong id="l">0g</strong></div>
      </div>
      <div class="chart-wrap">
        <canvas id="chart" class="chart"></canvas>
        <div class="leg">
          <div><span style="background:#51cf66"></span> Karbo</div>
          <div><span style="background:#ffd43b"></span> Protein</div>
          <div><span style="background:#ff6b6b"></span> Lemak</div>
        </div>
      </div>
      <button class="btn" onclick="save()">Simpan ke Riwayat</button>
    </div>
  </div>

  <!-- RIWAYAT -->
  <div id="history-page" class="page">
    <h1>Riwayat</h1>
    <p class="s">Semua yang kamu cari</p>

    <div id="daily" class="daily-total hidden">Total Hari Ini: <span id="todaykcal">0</span> kcal</div>

    <div id="list"></div>
    <button class="clear" onclick="clearAll()">Hapus Semua Riwayat</button>
  </div>

  <!-- TENTANG -->
  <div id="about-page" class="page">
    <h1>Tentang</h1>
    <p class="s">RifqyCalory v12 • 280+ item Indonesia<br>© 2025 RifqyLCC</p>
  </div>
</div>

<div class="nav">
  <div class="ni active" onclick="show('search')">Cari</div>
  <div class="ni" onclick="show('history')">Riwayat</div>
  <div class="ni" onclick="show('about')">Tentang</div>
</div>

<script>
  let tab='makanan', db={}, chart;
  const today = new Date().toLocaleDateString('id-ID',{day:'numeric',month:'short',year:'numeric'});

  async function load(){try{const a=await fetch('makanan.js').then(r=>r.text()),b=await fetch('minuman.js').then(r=>r.text());eval(a);eval(b);db.makanan=makananDB;db.minuman=minumanDB;}catch{alert('Database error')}}
  function switchTab(t){tab=t;document.querySelectorAll('.tb').forEach(b=>b.classList.remove('active'));document.querySelector(`.tb[onclick="switchTab('${t}')"]`).classList.add('active');document.getElementById('card').classList.add('hidden');document.getElementById('i').value='';document.getElementById('res').innerHTML=''}
  function show(p){document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));document.getElementById(p+'-page').classList.add('active');document.querySelectorAll('.ni').forEach(n=>n.classList.remove('active'));document.querySelector(`.ni[onclick="show('${p}')"]`).classList.add('active');if(p==='history')loadHistory()}
  function searchFood(){
    const q=document.getElementById('i').value.toLowerCase().trim(),r=document.getElementById('res');r.innerHTML='';
    if(q.length<2)return;
    const items=Object.values(db[tab]).filter(i=>i.name.toLowerCase().includes(q));
    if(!items.length){r.innerHTML='<div style="padding:20px;text-align:center;opacity:0.7">Tidak ditemukan</div>';return}
    items.slice(0,15).forEach(item=>{
      const d=document.createElement('div');d.className='ri';
      d.innerHTML=`<div class="n">\( {item.name}</div><div class="c"> \){item.cal} kcal • Karbo \( {item.carb}g • Prot \){item.prot}g • Lemak ${item.fat}g</div>`;
      d.onclick=()=>{display(item);r.innerHTML='';document.getElementById('i').value=item.name};r.appendChild(d);
    });
  }
  function display(item){
    document.getElementById('name').textContent=item.name;
    document.getElementById('kcal').textContent=item.cal;
    document.getElementById('k').textContent=item.carb+'g';
    document.getElementById('p').textContent=item.prot+'g';
    document.getElementById('l').textContent=item.fat+'g';
    document.getElementById('card').classList.remove('hidden');
    if(chart)chart.destroy();
    chart=new Chart(document.getElementById('chart'),{type:'doughnut',data:{datasets:[{data:[item.carb,item.prot,item.fat],backgroundColor:['#51cf66','#ffd43b','#ff6b6b'],borderWidth:0}]},options:{responsive:true,maintainAspectRatio:false,cutout:'68%',plugins:{legend:{display:false}}}});
  }
  function save(){
    const n=document.getElementById('name').textContent,c=parseInt(document.getElementById('kcal').textContent);
    const h=JSON.parse(localStorage.getItem('rc')||'[]');
    h.push({n,c,d:new Date().toLocaleDateString('id-ID',{day:'numeric',month:'short',year:'numeric'}),t:new Date().toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'})});
    localStorage.setItem('rc',JSON.stringify(h));
    alert('Disimpan!');
  }
  function loadHistory(){
    const h=JSON.parse(localStorage.getItem('rc')||'[]');
    const l=document.getElementById('list');l.innerHTML='';
    let todayCal=0;
    h.forEach(i=>{if(i.d===today)todayCal+=i.c});
    document.getElementById('todaykcal').textContent=todayCal;
    document.getElementById('daily').classList.toggle('hidden',todayCal===0);
    if(h.length===0){l.innerHTML='<p style="text-align:center;opacity:0.7;padding:50px;font-weight:600">Belum ada riwayat</p>';return}
    h.slice().reverse().forEach((i,x)=>{
      const d=document.createElement('div');d.className='hi';
      d.innerHTML=`<div><div class="hit">\( {i.d} • \){i.t}</div><div class="hin">\( {i.n}</div><div class="hic"> \){i.c} kcal</div></div><button class="del" onclick="del(${h.length-1-x})">Hapus</button>`;
      l.appendChild(d);
    });
  }
  function del(i){if(confirm('Hapus?')){const h=JSON.parse(localStorage.getItem('rc')||'[]');h.splice(i,1);localStorage.setItem('rc',JSON.stringify(h));loadHistory()}}
  function clearAll(){if(confirm('Hapus semua?')){localStorage.removeItem('rc');loadHistory()}}
  load().then(()=>{document.getElementById('i').focus()});
</script>
</body>
</html>
